<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <meta name="color-scheme" content="dark" />

  <!-- iPhone (PWA) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <title>To-Do</title>

  <style>
    :root{
      --bg0:#071018;
      --bg1:#0b0f1a;
      --card:#0f1b2a;
      --card2:#0c1522;
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --green:#2fe07b;
      --green2:#1fbf63;
      --red:#ff4d4d;
      --yellow:#ffd369;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 22px;
      --r2: 16px;
      --pad: 18px;
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; background: radial-gradient(1200px 800px at 30% 5%, rgba(70,220,255,.08), transparent 60%),
                              radial-gradient(900px 700px at 70% 20%, rgba(47,224,123,.08), transparent 55%),
                              linear-gradient(180deg, var(--bg0), var(--bg1));
              color:var(--text); font-family: var(--font); margin:0; }
    body{
      padding: calc(env(safe-area-inset-top) + 22px) 16px calc(env(safe-area-inset-bottom) + 18px);
    }
    /* Safe-area dunkler Hintergrund */
    body::before{
      content:"";
      position: fixed;
      top: 0; left: 0; right: 0;
      height: env(safe-area-inset-top);
      background: #0b0f1a;
      z-index: 999999;
      pointer-events:none;
    }

    .wrap{
      max-width: 900px;
      margin: 0 auto;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    header{
      padding: 22px 22px 14px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 16px;
    }
    h1{
      margin:0;
      font-size: 44px;
      letter-spacing: .3px;
      line-height: 1;
    }
    .sub{
      margin-top: 10px;
      color: var(--muted);
      font-size: 15px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-weight: 600;
      white-space: nowrap;
      user-select:none;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--green);
      box-shadow: 0 0 14px rgba(47,224,123,.55);
    }

    .content{
      padding: 0 22px 22px;
    }

    .row{
      display:flex;
      gap: 12px;
      align-items:center;
      flex-wrap: wrap;
    }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 14px 16px;
      border-radius: 16px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:active{ transform: scale(.98); }
    .btn.green{
      background: linear-gradient(180deg, rgba(47,224,123,.95), rgba(31,191,99,.92));
      border-color: rgba(47,224,123,.35);
      color:#06140b;
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
    }
    .btn.red{
      background: rgba(255,77,77,.12);
      border-color: rgba(255,77,77,.25);
      color: rgba(255,255,255,.92);
    }

    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .panel{
      background: rgba(0,0,0,.18);
      border: 1px solid var(--stroke);
      border-radius: var(--r2);
      padding: var(--pad);
    }

    .label{
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .6px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    input[type="text"], input[type="time"]{
      width: 100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: rgba(8,16,26,.55);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }
    input::placeholder{ color: rgba(255,255,255,.35); }

    .days{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 4px;
    }
    .day{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      user-select:none;
      font-weight: 800;
      color: rgba(255,255,255,.86);
    }
    .day input{ display:none; }
    .day.on{
      background: rgba(47,224,123,.16);
      border-color: rgba(47,224,123,.30);
      box-shadow: 0 0 0 1px rgba(47,224,123,.10) inset;
    }

    .tasks{
      margin-top: 14px;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .task{
      display:grid;
      grid-template-columns: 44px 1fr auto;
      gap: 12px;
      align-items: center;
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid var(--stroke);
    }

    .check{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
    }
    .check.on{
      border-color: rgba(47,224,123,.35);
      background: rgba(47,224,123,.16);
    }
    .check svg{ opacity:.95; }

    .t-title{
      font-weight: 900;
      font-size: 18px;
      line-height: 1.2;
    }
    .t-meta{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .tag{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      padding: 6px 10px;
      border-radius: 999px;
      color: rgba(255,255,255,.78);
      font-weight: 800;
    }
    .tag.soon{ border-color: rgba(255,211,105,.30); background: rgba(255,211,105,.12); }
    .tag.over{ border-color: rgba(255,77,77,.28); background: rgba(255,77,77,.12); }

    .actions{
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .iconbtn{
      width: 40px; height: 40px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, background .15s ease;
    }
    .iconbtn:active{ transform: scale(.98); }
    .iconbtn.red{ border-color: rgba(255,77,77,.25); background: rgba(255,77,77,.10); }

    .muted{ color: var(--muted2); }

    .modal{
      position: fixed;
      inset: 0;
      display:none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      z-index: 1000000;
    }
    .modal.active{ display:flex; }
    .modal .box{
      width: min(560px, 100%);
      border-radius: 22px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(15,27,42,.95), rgba(12,21,34,.92));
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modal .box header{
      padding: 16px 16px 10px;
      align-items:center;
    }
    .modal h2{
      margin:0;
      font-size: 20px;
      font-weight: 1000;
    }
    .modal .close{
      margin-left:auto;
      width: 42px; height: 42px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-size: 20px;
      cursor:pointer;
    }
    .modal .inner{
      padding: 0 16px 16px;
      display:grid;
      gap: 10px;
    }

    @media (min-width: 860px){
      .grid{ grid-template-columns: 1.05fr .95fr; align-items:start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>To-Do</h1>
          <div class="sub">Ohne Listen: einfach Aufgaben mit Tagen + Uhrzeit + Person.</div>
        </div>
        <div class="pill"><span class="dot"></span><span id="statusText">Bereit</span></div>
      </header>

      <div class="content">
        <div class="grid">
          <div class="panel">
            <div class="label">Schnelleingabe</div>
            <input id="quickInput" type="text" placeholder="wÃ¤sche aufhÃ¤ngen; mo, fr; 13:00 Uhr; Mama" />
            <div class="row" style="margin-top:10px;">
              <button class="btn green" id="quickAddBtn">HinzufÃ¼gen</button>
              <button class="btn ghost" id="fillExampleBtn">Beispiel einsetzen</button>
            </div>

            <div style="height:14px;"></div>

            <div class="label">Oder normal eingeben</div>

            <div class="row" style="margin-top:8px;">
              <div style="flex: 2 1 240px;">
                <input id="taskText" type="text" placeholder="Aufgabe (z. B. WÃ¤sche aufhÃ¤ngen)" />
              </div>
              <div style="flex: 1 1 160px;">
                <input id="taskTime" type="time" value="13:00" />
              </div>
              <div style="flex: 1 1 180px;">
                <input id="taskPerson" type="text" placeholder="Person (z. B. Mama)" />
              </div>
            </div>

            <div class="label" style="margin-top:14px;">Wochentage</div>
            <div class="days" id="daysWrap"></div>

            <div class="row" style="margin-top:14px;">
              <button class="btn green" id="addBtn">Aufgabe erstellen</button>
              <button class="btn red" id="clearAllBtn" title="Alle Aufgaben lÃ¶schen">Alles lÃ¶schen</button>
            </div>

            <div class="sub muted" style="margin-top:10px;">
              Tipp: â€žErledigtâ€œ markiert immer den <b>nÃ¤chsten Termin</b> als erledigt (dann springtâ€™s automatisch zum nÃ¤chsten Tag).
            </div>
          </div>

          <div class="panel">
            <div class="row" style="justify-content: space-between;">
              <div class="label" style="margin:0;">Aufgaben</div>
              <div class="row" style="gap:8px;">
                <button class="btn ghost" id="filterAllBtn">Alle</button>
                <button class="btn ghost" id="filterTodayBtn">Heute</button>
              </div>
            </div>

            <div class="tasks" id="tasksWrap"></div>
            <div class="sub muted" id="emptyHint" style="display:none; margin-top:12px;">
              Noch nichts drin. Erstell oben eine Aufgabe.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="box">
      <header>
        <h2>Aufgabe bearbeiten</h2>
        <button class="close" id="editClose">âœ•</button>
      </header>
      <div class="inner">
        <div class="label">Aufgabe</div>
        <input id="editText" type="text" />
        <div class="row">
          <div style="flex:1 1 160px;">
            <div class="label" style="margin-top:10px;">Uhrzeit</div>
            <input id="editTime" type="time" />
          </div>
          <div style="flex:1 1 220px;">
            <div class="label" style="margin-top:10px;">Person</div>
            <input id="editPerson" type="text" />
          </div>
        </div>
        <div class="label" style="margin-top:10px;">Wochentage</div>
        <div class="days" id="editDaysWrap"></div>

        <div class="row" style="margin-top: 10px;">
          <button class="btn green" id="editSave">Speichern</button>
          <button class="btn ghost" id="editCancel">Abbrechen</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LS_KEY = "todoData_v1";

    const WEEKDAYS = [
      { idx: 1, key: "mo", label: "Mo" },
      { idx: 2, key: "di", label: "Di" },
      { idx: 3, key: "mi", label: "Mi" },
      { idx: 4, key: "do", label: "Do" },
      { idx: 5, key: "fr", label: "Fr" },
      { idx: 6, key: "sa", label: "Sa" },
      { idx: 0, key: "so", label: "So" },
    ];

    const $ = (id) => document.getElementById(id);

    const statusText = $("statusText");
    const daysWrap = $("daysWrap");
    const tasksWrap = $("tasksWrap");
    const emptyHint = $("emptyHint");

    const quickInput = $("quickInput");
    const quickAddBtn = $("quickAddBtn");
    const fillExampleBtn = $("fillExampleBtn");

    const taskText = $("taskText");
    const taskTime = $("taskTime");
    const taskPerson = $("taskPerson");

    const addBtn = $("addBtn");
    const clearAllBtn = $("clearAllBtn");

    const filterAllBtn = $("filterAllBtn");
    const filterTodayBtn = $("filterTodayBtn");

    // Edit modal
    const editModal = $("editModal");
    const editClose = $("editClose");
    const editCancel = $("editCancel");
    const editSave = $("editSave");
    const editText = $("editText");
    const editTime = $("editTime");
    const editPerson = $("editPerson");
    const editDaysWrap = $("editDaysWrap");
    let editingId = null;

    let filterMode = "all"; // "all" | "today"

    function setStatus(msg){
      statusText.textContent = msg;
      clearTimeout(setStatus._t);
      setStatus._t = setTimeout(() => statusText.textContent = "Bereit", 1200);
    }

    function uid(){
      return "t_" + Math.random().toString(16).slice(2) + "_" + Date.now();
    }

    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return { tasks: [] };
        const data = JSON.parse(raw);
        if(!data || !Array.isArray(data.tasks)) return { tasks: [] };
        return data;
      }catch(e){
        return { tasks: [] };
      }
    }

    function save(data){
      localStorage.setItem(LS_KEY, JSON.stringify(data));
    }

    function normalizeTime(s){
      if(!s) return "";
      s = String(s).toLowerCase().replace("uhr","").trim();
      // accept "13.00" or "13:00"
      s = s.replace(".", ":");
      // if "13" only -> "13:00"
      if(/^\d{1,2}$/.test(s)) s = s.padStart(2,"0") + ":00";
      if(/^\d{1,2}:\d{2}$/.test(s)){
        const [h,m] = s.split(":").map(x => parseInt(x,10));
        if(Number.isFinite(h) && Number.isFinite(m) && h>=0 && h<=23 && m>=0 && m<=59){
          return String(h).padStart(2,"0") + ":" + String(m).padStart(2,"0");
        }
      }
      return "";
    }

    function parseDays(s){
      if(!s) return [];
      s = String(s).toLowerCase();
      // allow "mo, fr" "mo fr" "mo/fr"
      const parts = s.split(/[,/ ]+/).map(x => x.trim()).filter(Boolean);
      const map = new Map(WEEKDAYS.map(d => [d.key, d.idx]));
      const out = [];
      for(const p of parts){
        const key = p.slice(0,2);
        if(map.has(key) && !out.includes(map.get(key))) out.push(map.get(key));
      }
      out.sort((a,b)=>a-b);
      return out;
    }

    function daysToLabel(days){
      const idxToLab = new Map(WEEKDAYS.map(d => [d.idx, d.label]));
      return days.map(d => idxToLab.get(d)).join(", ");
    }

    function todayIdx(){
      return new Date().getDay(); // 0..6
    }

    function nextOccurrence(task, now = new Date()){
      // returns Date of next occurrence >= now (strictly in future if already passed today)
      if(!task.days || task.days.length === 0) return null;
      const t = (task.time || "00:00").split(":");
      const hh = parseInt(t[0],10) || 0;
      const mm = parseInt(t[1],10) || 0;

      const start = new Date(now);
      start.setSeconds(0,0);

      // If task has lastCompletedIso equal to an occurrence, we must pick the next after that too.
      const lastCompleted = task.lastCompletedIso ? new Date(task.lastCompletedIso) : null;

      for(let add=0; add<14; add++){
        const d = new Date(start);
        d.setDate(start.getDate() + add);
        const dow = d.getDay();
        if(!task.days.includes(dow)) continue;

        d.setHours(hh, mm, 0, 0);

        // must be after now OR equal but in future? if now is exactly the same minute, treat as due now:
        const candidateOk = d.getTime() >= start.getTime();

        if(!candidateOk) continue;

        // If already completed for that exact occurrence, skip to next.
        if(lastCompleted && Math.abs(d.getTime() - lastCompleted.getTime()) < 1000) continue;

        // If it's today but time already passed (in current minute logic), it wouldn't pass candidateOk, because start is now.
        return d;
      }
      return null;
    }

    function humanNextTag(dt){
      if(!dt) return { text: "Kein Termin", cls: "" };
      const now = new Date();
      const diff = dt.getTime() - now.getTime();
      const mins = Math.round(diff / 60000);

      // Overdue (should rarely happen with our nextOccurrence, but keep safe)
      if(mins < 0) return { text: "ÃœberfÃ¤llig", cls: "over" };

      if(mins <= 60) return { text: "Bald", cls: "soon" };

      return { text: "Geplant", cls: "" };
    }

    function fmtDate(dt){
      const wd = ["So","Mo","Di","Mi","Do","Fr","Sa"][dt.getDay()];
      const dd = String(dt.getDate()).padStart(2,"0");
      const mm = String(dt.getMonth()+1).padStart(2,"0");
      const hh = String(dt.getHours()).padStart(2,"0");
      const mi = String(dt.getMinutes()).padStart(2,"0");
      return `${wd} ${dd}.${mm}. â€“ ${hh}:${mi} Uhr`;
    }

    function buildDaysChooser(container, selected = []){
      container.innerHTML = "";
      for(const d of WEEKDAYS){
        const lab = document.createElement("label");
        lab.className = "day" + (selected.includes(d.idx) ? " on" : "");
        lab.innerHTML = `
          <input type="checkbox" data-idx="${d.idx}" ${selected.includes(d.idx) ? "checked" : ""} />
          <span>${d.label}</span>
        `;
        lab.addEventListener("click", (e)=>{
          // let input toggle, then update class
          const inp = lab.querySelector("input");
          setTimeout(()=> lab.classList.toggle("on", inp.checked), 0);
        });
        container.appendChild(lab);
      }
    }

    function readSelectedDays(container){
      const checks = Array.from(container.querySelectorAll('input[type="checkbox"]'));
      return checks.filter(c => c.checked).map(c => parseInt(c.dataset.idx,10)).sort((a,b)=>a-b);
    }

    function resetCreateForm(){
      taskText.value = "";
      taskPerson.value = "";
      // time stays
      // days stay (user preference) -> keep
    }

    function parseQuickLine(line){
      // "wÃ¤sche aufhÃ¤ngen; mo, fr; 13:00 Uhr; Mama"
      const parts = String(line).split(";").map(p => p.trim()).filter(p => p.length);
      if(parts.length < 3) return null;

      const text = parts[0] || "";
      const days = parseDays(parts[1] || "");
      const time = normalizeTime(parts[2] || "");
      const person = parts[3] ? parts[3].trim() : "";

      if(!text) return null;
      if(days.length === 0) return null;
      if(!time) return null;

      return { text, days, time, person };
    }

    function createTask(obj){
      const data = load();

      const task = {
        id: uid(),
        text: obj.text.trim(),
        days: obj.days,
        time: obj.time,
        person: (obj.person || "").trim(),
        createdAt: new Date().toISOString(),
        lastCompletedIso: null
      };

      data.tasks.unshift(task);
      save(data);
      setStatus("Gespeichert");
      render();
    }

    function deleteTask(id){
      const data = load();
      data.tasks = data.tasks.filter(t => t.id !== id);
      save(data);
      setStatus("GelÃ¶scht");
      render();
    }

    function markDoneForNext(id){
      const data = load();
      const t = data.tasks.find(x => x.id === id);
      if(!t) return;

      const next = nextOccurrence(t, new Date());
      if(!next){
        setStatus("Kein Termin");
        return;
      }
      t.lastCompletedIso = next.toISOString();
      save(data);
      setStatus("Erledigt");
      render();
    }

    function openEdit(id){
      const data = load();
      const t = data.tasks.find(x => x.id === id);
      if(!t) return;

      editingId = id;
      editText.value = t.text || "";
      editTime.value = t.time || "13:00";
      editPerson.value = t.person || "";
      buildDaysChooser(editDaysWrap, t.days || []);

      editModal.classList.add("active");
    }

    function closeEdit(){
      editModal.classList.remove("active");
      editingId = null;
    }

    function saveEdit(){
      const data = load();
      const t = data.tasks.find(x => x.id === editingId);
      if(!t) return;

      const newText = (editText.value || "").trim();
      const newTime = normalizeTime(editTime.value);
      const newPerson = (editPerson.value || "").trim();
      const newDays = readSelectedDays(editDaysWrap);

      if(!newText){ setStatus("Text fehlt"); return; }
      if(!newTime){ setStatus("Zeit ungÃ¼ltig"); return; }
      if(newDays.length === 0){ setStatus("Tage fehlen"); return; }

      t.text = newText;
      t.time = newTime;
      t.person = newPerson;
      t.days = newDays;

      // If edited schedule, reset completion so it doesn't get stuck
      t.lastCompletedIso = null;

      save(data);
      setStatus("Aktualisiert");
      closeEdit();
      render();
    }

    function render(){
      // keep create days chooser built once; just ensure it exists
      const data = load();

      // compute next occurrences + sort by next time
      const now = new Date();
      const tasks = data.tasks.map(t => {
        const next = nextOccurrence(t, now);
        return { ...t, _next: next, _nextTs: next ? next.getTime() : Number.POSITIVE_INFINITY };
      });

      const today = todayIdx();

      let shown = tasks.slice();

      if(filterMode === "today"){
        shown = shown.filter(t => t.days && t.days.includes(today));
      }

      shown.sort((a,b)=> a._nextTs - b._nextTs);

      tasksWrap.innerHTML = "";

      emptyHint.style.display = shown.length ? "none" : "block";

      for(const t of shown){
        const next = t._next;
        const isToday = next ? (next.getDay() === today) : false;

        const tag = humanNextTag(next);
        const meta = [];

        meta.push(`<span class="tag">${daysToLabel(t.days)}</span>`);
        meta.push(`<span class="tag">${t.time} Uhr</span>`);
        if(t.person) meta.push(`<span class="tag">${escapeHtml(t.person)}</span>`);
        if(next) meta.push(`<span class="tag ${tag.cls}">${isToday ? "Heute" : fmtDate(next)}</span>`);

        const taskEl = document.createElement("div");
        taskEl.className = "task";

        // check means "done for next occurrence"
        taskEl.innerHTML = `
          <div class="check" title="NÃ¤chsten Termin als erledigt markieren">
            ${checkSvg(false)}
          </div>
          <div>
            <div class="t-title">${escapeHtml(t.text)}</div>
            <div class="t-meta">${meta.join("")}</div>
          </div>
          <div class="actions">
            <button class="iconbtn" title="Bearbeiten">âœŽ</button>
            <button class="iconbtn red" title="LÃ¶schen">ðŸ—‘</button>
          </div>
        `;

        const checkBtn = taskEl.querySelector(".check");
        const editBtn = taskEl.querySelector(".iconbtn");
        const delBtn = taskEl.querySelector(".iconbtn.red");

        checkBtn.addEventListener("click", ()=>{
          markDoneForNext(t.id);
        });
        editBtn.addEventListener("click", ()=>{
          openEdit(t.id);
        });
        delBtn.addEventListener("click", ()=>{
          // simple confirm
          if(confirm("Wirklich lÃ¶schen?")){
            deleteTask(t.id);
          }
        });

        tasksWrap.appendChild(taskEl);
      }

      // UI state for filter buttons
      filterAllBtn.style.borderColor = (filterMode==="all") ? "rgba(47,224,123,.35)" : "rgba(255,255,255,.10)";
      filterTodayBtn.style.borderColor = (filterMode==="today") ? "rgba(47,224,123,.35)" : "rgba(255,255,255,.10)";
    }

    function checkSvg(on){
      return `
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M20 6L9 17l-5-5" stroke="rgba(47,224,123,.95)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      `;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // init day choosers
    buildDaysChooser(daysWrap, [1,5]); // default Mo+Fr wie Beispiel

    // events
    fillExampleBtn.addEventListener("click", ()=>{
      quickInput.value = "wÃ¤sche aufhÃ¤ngen; mo, fr; 13:00 Uhr; Mama";
    });

    quickAddBtn.addEventListener("click", ()=>{
      const parsed = parseQuickLine(quickInput.value);
      if(!parsed){
        setStatus("Format falsch");
        return;
      }
      createTask(parsed);
      quickInput.value = "";
    });

    addBtn.addEventListener("click", ()=>{
      const text = (taskText.value || "").trim();
      const time = normalizeTime(taskTime.value);
      const person = (taskPerson.value || "").trim();
      const days = readSelectedDays(daysWrap);

      if(!text){ setStatus("Text fehlt"); return; }
      if(!time){ setStatus("Zeit ungÃ¼ltig"); return; }
      if(days.length === 0){ setStatus("Tage fehlen"); return; }

      createTask({ text, days, time, person });
      resetCreateForm();
    });

    clearAllBtn.addEventListener("click", ()=>{
      if(confirm("Wirklich ALLES lÃ¶schen?")){
        save({ tasks: [] });
        setStatus("Alles gelÃ¶scht");
        render();
      }
    });

    filterAllBtn.addEventListener("click", ()=>{
      filterMode = "all";
      render();
    });

    filterTodayBtn.addEventListener("click", ()=>{
      filterMode = "today";
      render();
    });

    // edit modal
    editClose.addEventListener("click", closeEdit);
    editCancel.addEventListener("click", closeEdit);
    editSave.addEventListener("click", saveEdit);
    editModal.addEventListener("click", (e)=>{
      if(e.target === editModal) closeEdit();
    });

    // first render
    render();

    // live refresh every minute (next dates)
    setInterval(render, 30000);
  </script>
</body>
</html>
